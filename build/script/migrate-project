#!/bin/sh

# Migrate a charcoal project to the monorepo version
cd $(dirname $0)

CHARCOAL_BASE=../../
PROJECT_BASE=../../../
FILE=config/config.json

echo navigating to charcoal directory

cd $CHARCOAL_BASE

echo Fetching and parsing charcoal packages

PACKAGES="$(vendor/bin/monorepo-builder packages-json)"

PACKAGES=$(sed -Ee 's/(\[|\]|")//g' <<< $PACKAGES)
PACKAGES=$(sed -Ee 's/,/|/g' <<< $PACKAGES)

echo Replacing metadata paths in ${PROJECT_BASE}${FILE}

NEW_CONTENT=$(sed -Ee "s#vendor/locomotivemtl/charcoal-($PACKAGES)#%package.\1.path%#g" ${PROJECT_BASE}${FILE})

echo "$NEW_CONTENT" > ${PROJECT_BASE}${FILE}
