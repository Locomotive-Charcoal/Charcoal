name: Release

on:
    push:
        branches:
            - main
            - beta
            - alpha
            - next
            - next-major

env:
    GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}

jobs:
    release:
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout project
                uses: actions/checkout@v3
                with:
                    persist-credentials: false

            -   uses: bahmutov/npm-install@v1

            -   name: Setup PHP
                uses: shivammathur/setup-php@v2
                with:
                    php-version: 8.0
                    coverage: none

            # semantic release local configuration needs to call ./vendor/bin/monorepo-builder
            -   name: Install Dependencies
                uses: ramsey/composer-install@v2

            -   name: Semantic Release
                uses: cycjimmy/semantic-release-action@v3
                with:
                    semantic_version: 19
                env:
                    GH_TOKEN: ${{ secrets.ACCESS_TOKEN }}
